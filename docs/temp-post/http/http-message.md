---
title: 3. http 메시지
category:
  - Infra.
tag:
  - Http
timeline: false
article: false
---

HTTP가 인터넷 배달원이라면, HTTP 메시지는 무언가 담아 보내는 소포와 같다.
이번 챕터는 HTTP 메세지의 모든 것에 대해 말해준다.

- 메시지가 어떻게 흘러가는가
- HTTP 메세지의 세 부분(시작줄, 헤더, 개체 본문)
- 요청과 응답 메시지의 차이
- 요청 메시지가 지원하는 여러 기능(메서드)들
- 응답 메시지가 반환하는 여러 상태 코드들
- 여러 HTTP 헤더들은 무슨 일을 하는가

## 메시지의 흐름

HTTP 메시지는 HTTP 애플리케이션 간에 주고받은 데이터의 블록들이다.
이 데이터의 블록들은 메시지의 내용과 의미를 설명하는 텍스트 메타 정보로 시작하고 그 다음에 선택적으로 데이터가 올 수 있다.
이 메시지는 클라이언트, 서버, 프락시 사이를 흐른다.
'인바운드', '아웃바운드', '업스트림', '다운스트림'은 메시지의 방향을 의미하는 용어다.

### 메시지는 원 서버 방향을 인바운드로 하여 송신된다

HTTP는 인바운드와 아웃바운드라는 용어를 트랜잭션 방향을 표현하기 위해 사용한다.
메시지가 원 서버로 향하는 것은 인바운드로 이동하는 것이고,
모든 처리가 끝난 뒤에 메시지가 사용자 에이전트로 돌아오는 것은 아웃바운드로 이동하는 것이다.

![그림 3-1. 원 서버로 인바운드로 이동하고 클라이언트로 아웃바운드로 복귀하는 메시지](https://github.com/Zamoca42/blog/assets/96982072/280edbed-5f90-405e-9be9-1cd06a752494)

### 다운스트림으로 흐르는 메시지

![그림 3-2. 모든 메시지는 다운스트림으로 흐른다.](https://github.com/Zamoca42/blog/assets/96982072/7cbdd630-6da7-4b27-b6a7-f9a8e551fb2f)

## 메시지의 각 부분

HTTP 메시지는 단순한, 데이터의 구조화된 블록이다.
각 메세지는 클라이언트로부터 요청이나 서버로부터의 응답 중 하나를 포함한다.
메시지는 시작, 헤더, 본문 이렇게 세 부분으로 이루어진다.

시작줄은 이것이 어떤 메시지인지 서술하며, 헤더 블록은 속성을, 본문은 데이터를 담는다.

![그림 3-3. HTTP 메시지의 세 부분](https://github.com/Zamoca42/blog/assets/96982072/f5fc5f91-1cc7-4d44-bb56-9dfeba0c6d07)

본문이나 메시지는 단순히 선택적인 데이터 덩어리다.
시작줄이나 헤더와는 달리, 본문은 텍스트나 이진 데이터를 포함할 수도 있고, 그냥 비어있을 수도 있다.

헤더는 본문에 대한 꽤 많은 정보를 준다.
그림 3-3에서 Content-Type 줄은 본문이 텍스트 문서라고 알려준다.
Content-Length 줄은 본문의 크기를 말해준다.

### 메시지 문법

모든 HTTP 메시지는 요청 메시지나 응답 메시지로 분류된다.
요청 메시지는 웹 서버에 어떤 동작을 요구한다. 응답 메시지는 요청의 결과를 클라이언트에게 돌려준다.
요청과 응답 모두 기본적으로 구조가 같다.
GIF image를 가져오기 위한 요청과 응답 메시지를 보여준다.

![그림 3-4. 요청과 응답 메시지를 포함한 HTTP 트랜잭션](https://github.com/Zamoca42/blog/assets/96982072/1d79f825-04f2-41e1-b478-f6cc7ec6c501)

요청, 응답 메시지의 예시는 다음과 같다

![그림 3-5. 요청과 응답 메시지의 예](https://github.com/Zamoca42/blog/assets/96982072/e78766f9-fe73-440a-8128-a721f1e0e00c)

## 메서드

요청의 시작줄은 메서드로 시작하며, 서버에게 무엇울 해야하는지 말해준다.
예를 들어, 'GET /specials/saw-blade.gif HTTP/1.0'이라는 줄에서 메서드는 GET이다.
HTTP 명세는 공통 요청 메서드의 집합을 정의한다.
예를 들어, GET 메서드는 서버에서 문서를 가져오는 것이며, POST 메서드는 서버가 처리해줬으면 하는 데이터를 보내는 것이고,
OPTIONS 메서드는 웹 서버의 일반적인 지원 범위 혹은 웹 서버의 특정 리소스에 대한 지원 범위를 알아보는 것이다.

### GET

GET은 가장 흔히 쓰이는 메서드다. 주로 서버에게 로스스를 달라고 요청하기 위해 쓰인다.

![그림 3-7. GET의 예](https://github.com/Zamoca42/blog/assets/96982072/0d784fd6-63d7-4e83-b456-0aa25d1b9ab8)

### HEAD

HEAD 메서드는 정확히 GET처럼 행동하지만, 서버는 응답으로 헤더만 돌려준다.
엔터티 본문은 결코 반환되지 않는다.

이는 클라이언트가 리소스를 실제로 가져올 필요 없이 헤더만을 조사할 수 있도록 해준다.
HEAD를 사용하면

- 리소스를 가져오지 않고도 그에 대해 무엇인가를 알아낼 수 있다.
- 응답의 상태 코드를 통해, 개체가 존재하는지 확인할 수 있다.
- 헤더를 확인하여 리소스가 변경되었는지 검사할 수 있다.

서버 개발자들은 반드시 반환되는 헤더가 GET으로 얻는 것과 정확히 일치함을 보장해야한다.

![그림 3-8. HEAD의 예](https://github.com/Zamoca42/blog/assets/96982072/dcea378b-c7d8-4a32-b4de-422412b21562)

### PUT

PUT 메서드의 의미는, 서버가 요청의 본문을 가지고 요청 URL의 이름대로 새 문서를 만들거나,
이미 URL이 존재한다면 본문을 사용해서 교체하는 것이다.

![그림 3-9. PUT의 예](https://github.com/Zamoca42/blog/assets/96982072/f15d234a-9506-46c3-ad7f-7a72ef78d157)

### POST

POST 메서드는 서버에 입력 데이터를 전송하기 위해 설계 되었다.
실제로 HTML 폼을 지원하기 위해 흔히 사용된다.

![그림 3-10. POST의 예](https://github.com/Zamoca42/blog/assets/96982072/092a105e-6020-4eeb-be3f-a68b354eabf8)

## 상태 코드

메서드가 서버에게 무엇을 해야 하는지 말해주는 것처럼, 상태 코드는 클라이언트에게 무엇이 일어났는지 말해준다.
상태 코드는 응답의 시작줄에 위치한다. 예를들어, 'HTTP/1.0 200 OK'라는 줄에서 상태 코드는 200이다.

클라이언트가 HTTP 서버에게 요청 메시지를 보낼 때, 많은 일이 일어난다.
만약 운이 좋다면 요청은 완전히 성공할 것이다.
그러나 항상 운이 좋을 수는 없다.
서버는 요청한 리소스가 발견되지 않았거나, 그 리소스에 접근할 권한이 없거나, 어쩌면 그 리소스가 다른 곳으로 옮겨졌다고 알려올 수도 있다.

상태 코드는 각 응답 메시지의 시작줄에 담겨 반환된다. 숫자로 된 코드와 문자열로 되어 있어 사람이 이해하기 쉬운 메시지 두 형태 모두로 반환된다.
사유 구절이 사람에게 쉽게 읽히는 한편, 숫자로 된 코드는 프로그램이 에러를 처리하기 쉽다.

| 상태 코드 | 사유 구절    | 의미                                               |
| --------- | ------------ | -------------------------------------------------- |
| 200       | OK           | 성공! 모든 데이터는 응답 본문에 들어있다.          |
| 401       | Unauthorized | 사용자 이름과 비밀번호를 입력해야 한다.            |
| 404       | Not Found    | 서버는 요청한 URL에 해당하는 리소스를 찾지 못했다. |

## 헤더

HTTP 헤더 필드는 요청과 응답 메시지에 추가 정보를 더한다.
그들은 기본적으로 이름/값 쌍의 목록이다.

| 헤더의 예                                | 설명                                                     |
| ---------------------------------------- | -------------------------------------------------------- |
| Date: Tue, 3 Oct 1997 02:16:03 GMT       | 서버가 응답을 만들어 낸 시각                             |
| Content-length: 15040                    | 15,040 바이트의 데이터를 포함한 엔터티 본문              |
| Content-type: image/gif                  | 본문의 데이터 타입은 GIF 이미지다                        |
| Accept: image/gif, image/jpeg, text/html | 클라이언트는 GIF, JPEG 이미지와 HTML을 받아들일 수 있다. |

### 일반 헤더

요청과 응답에서 모두 메시지에 대한 기본적인 정보를 제공한다.

| 헤더                     | 설명                                                                        |
| ------------------------ | --------------------------------------------------------------------------- |
| Connection               | 클라이언트와 서버가 요청/응답 연결에 대한 옵션을 정할 수 있게 해준다.       |
| Date                     | 메시지가 언제 만들어졌는지에 대한 날짜와 시간을 제공한다.                   |
| MIME-Version             | 발송자가 사용한 MIME의 버전을 알려준다.                                     |
| Trailer chunked transfer | 인코딩으로 인코딩된 메시지의 끝 부분에 위치한 헤더들의 목록을 나열한다.     |
| Transfer-Encoding        | 수신자에게 안전한 전송을 위해 메시지에 어떤 인코딩이 적용되었는지 말해준다. |

#### 일반 캐시 헤더

HTTP/1.0은 HTTP 애플리케이션에게 매번 원 서버로부터 객체를 가져오는 대신 로컬 복사본으로 캐시할 수 있도록 해주는 최초의 헤더를 도입했다.

| 헤더          | 설명                                                |
| ------------- | --------------------------------------------------- |
| Cache-Control | 메시지와 함께 캐시 지시자를 전달하기 위해 사용한다. |

### 요청 헤더

요청에 대한 부가 정보를 제공하는 헤더다.

| 헤더       | 설명                                                             |
| ---------- | ---------------------------------------------------------------- |
| Client-IP  | 클라이언트가 실행된 컴퓨터의 IP를 제공한다.                      |
| From       | 클라이언트 사용자의 메일 주소를 제공한다.                        |
| Host       | 요청의 대상이 되는 서버의 호스트 명과 포트를 준다.               |
| Referer    | 현재의 요청 URI가 들어있었던 문서의 URL을 제공한다.              |
| UA-Color   | 클라이언트 기기 디스플레이의 색상 능력에 대한 정보를 제공한다.   |
| UA-CPU     | 클라이언트 CPU의 종류나 제조사를 알려준다.                       |
| UA-Disp    | 클라이언트의 디스플레이(화면) 능력에 대한 정보를 제공한다.       |
| UA-OS      | 클라이언트 기기에서 동작 중인 운영체제의 이름과 버전을 알려준다. |
| UA-Pixels  | 클라이언트 기기 디스플레이에 대한 픽셀 정보를 제공한다.          |
| User-Agent | 요청을 보낸 애플리케이션의 이름을 서버에게 말해준다.             |

#### Accept 관련 헤더

클라이언트는 Accept 관련 헤더들은 이용해 서버에게 자신의 선호와 능력을 알려 줄 수 있다.
즉 클라이언트가 무엇을 원하고 무엇을 할 수 있는지, 그리고 무엇보다도 원치 않는 것은 무엇인지 알려줄 수 있다.
Accept 관련 헤더들 은 서버와 클라이언트 양쪽 모두에게 유익하다.
클라이언트는 그들이 원하는 것을 얻을 수 있으며, 서버는 클라이언트가 사용할 수도 없는 것을 전송하는 데 시간과 대역폭을 낭비하지 않을 수 있다.

| 헤더            | 설명                                                   |
| --------------- | ------------------------------------------------------ |
| Accept          | 서버에게 서버가 보내도 되는 미디어 종류를 말해준다.    |
| Accept-Charset  | 서버에게 서버가 보내도 되는 문자집합을 말해준다.       |
| Accept-Encoding | 서버에게 서버가 보내도 되는 인코딩을 말해준다.         |
| Accept-Language | 서버에게 서버가 보내도 되는 언어를 말해준다.           |
| TE              | 서버에게 서버가 보내도 되는 확장 전송 코딩을 말해준다. |

#### 요청 보안 헤더

HTTP는 자체적으로 요청을 위한 간단한 인증요구/응답 체계를 갖고 있다.

| 헤더          | 설명                                                                                                                       |
| ------------- | -------------------------------------------------------------------------------------------------------------------------- |
| Authorization | 클라이언트가 서버에게 제공하는 인증 그 자체에 대한 정보를 담고 있다.                                                       |
| Cookie        | 클라이언트가 서버에게 토큰을 전달할 때 사용한다. <br> 진짜 보안 헤더는 아니지만, 보안에 영향을 줄 수 있다는 것은 확실하다. |

#### 프락시 요청 헤더

인터넷에서 프락시가 점점 혼해지면서, 그들의 기능을 돕기 위해 몇몇 헤더들이 정의되어 왔다.

| 헤더                | 설명                                                                                                                |
| ------------------- | ------------------------------------------------------------------------------------------------------------------- |
| Max-Forwards        | 요청이 원 서버로 향하는 과정에서 다른 프락시나 게이트웨이로 전달될 수 있는 최대 횟수, TRACE 메서드와 함께 사용된다. |
| Proxy-Authorization | Authorization과 같으나 프락시에서 인증을 할 때 쓰인다.                                                              |
| Proxy-Connection    | Connection과 같으나 프락시에서 연결을 맺을 때 쓰인다.                                                               |

### 응답 헤더

응답 헤더는 클라이언트에게 부가 정보를 제공한다.
누가 응답을 보내고 있는지 혹은 응답자의 능력은 어떻게 되는지 알려주며, 더 나아가 응답에 대한 특별한 설명도 제공할 수 있다.
이 헤더들은 클라이언트가 응답을 잘 다루고 나중에 더 나은 요청을 할 수 있도록 도와준다.

| 헤더        | 설명                                                                    |
| ----------- | ----------------------------------------------------------------------- |
| Age         | 응답이 얼마나 오래되었는지                                              |
| Public      | 서버가 특정 리소스에 대해 지원하는 요청 메서드의 목록                   |
| Retry-After | 현재 리소스가 사용 불가능한 상태일 때, 언제 가능해지는지 날짜 혹은 시각 |
| Server      | 서버 애플리케이션의 이름과 버전                                         |
| Title       | HTML 문서에서 주어진 것과 같은 제목                                     |
| Warning     | 사유 구절에 있는 것보다 더 자세한 경고 메시지                           |

### 엔티티 헤더

HTTP 메시지의 엔터티에 대해 설명하는 헤더들은 많다.
요청과 응답 양쪽 모두 엔터티를 포함할 수 있기 때문에, 이 헤더들은 양 타입의 메시지에 모두 나타날 수 있다.
엔터티 헤더는 엔터티와 그것의 내용물에 대한, 개체의 타입부터 시작해서 주어진 리소스에 대해 요청할 수 있는 유효한 메서드들까지,
광범위한 정보를 제공한다.

| 헤더     | 설명                                                            |
| -------- | --------------------------------------------------------------- |
| Allow    | 이 엔터티에 대해 수행될 수 있는 요청 메서드들을 나열한다.       |
| Location | 클라이언트에게 엔터티가 실제로 어디에 위치하고 있는지 말해준다. |

#### 콘텐츠 헤더

콘텐츠 헤더는 엔터티의 콘텐츠에 대한 구체적인 정보를 제공한다.
콘텐츠의 종류, 크기, 기타 콘텐츠를 처리할 때 유용하게 활용될 수 있는 것들이다.

| 헤더             | 설명                                                           |
| ---------------- | -------------------------------------------------------------- |
| Content-Base     | 본문에서 사용된 상대 URL을 계산하기 위한 기저 URL              |
| Content-Encoding | 본문에 적용된 어떤 인코딩                                      |
| Content-Language | 본문을 이해하는데 가장 적절한 자연어                           |
| Content-Length   | 본문의 길이나 크기                                             |
| Content-Location | 리소스가 실제로 어디에 위치하는지                              |
| Content-MD5      | 본문의 MD5 체크섬(checksum)                                    |
| Content-Range    | 전체 리소스에서 이 엔터티가 해당하는 범위를 바이트 단위로 표현 |
| Content-Type     | 이 본문이 어떤 종류의 객체인지                                 |

#### 엔티티 캐싱 헤더

일반 캐싱 헤더는 언제 어떻게 캐시가 되어야 하는지에 대한 지시자를 제공한다.
엔터티 캐싱 헤더는 엔터티 캐싱에 대한 정보를 제공한다.

| 헤더          | 설명                                                             |
| ------------- | ---------------------------------------------------------------- |
| ETag          | 이 엔터티에 대한 엔터티 태그                                     |
| Expires       | 이 엔터티가 더 이상 유효하지 않아 원본을 다시 받아와야 하는 일시 |
| Last-Modified | 가장 최근 이 엔터티가 변경된 일시                                |
